#!/bin/bash

#######################################################################
# Script de Coleta de Informações de Domínio                          #
#                                                                     #
# Este script coleta informações de um domínio especificado           #
# e salvar os resultados em um diretório.                             #
#                                                                     #
# Ferramentas utilizadas:                                             #
#   - Amass, Findomain, Subfinder e Assetfinder                       #
#     github-subdomains, chaos, haktrails, crt.sh                     #
#                                                                     #
# Uso: ./domain_info.sh <domínio>                                     #
#                                                                     #
# Autor: Pedro Henrique Maciel Alves                                  #
# Data: 13/10/23                                                      #
# Update: 27/10/23                                                    #                                                    #
#                                                                     #
#######################################################################

# Verifica se um domínio foi fornecido como argumento
if [ "$#" -ne 1 ]; then
    echo "Uso: $0 <domínio>"
    exit 1
fi

DOMAIN="$1"
RESULTS_DIR="$DOMAIN-results"

# Função para executar uma ferramenta e salvar os resultados
run_tool() {
    local tool_name="$1"
    local tool_command="$2"
    echo "Iniciando $tool_name..."
    $tool_command > "$RESULTS_DIR/${tool_name}_results.txt"
    echo "$tool_name concluído."
}

# Cria um diretório para armazenar os resultados
mkdir -p "$RESULTS_DIR"

# Executa as ferramentas
run_tool "Amass" "amass enum -d $DOMAIN"
run_tool "Findomain" "findomain -t $DOMAIN"
run_tool "Subfinder" "subfinder -d $DOMAIN"
run_tool "Assetfinder" "assetfinder --subs-only $DOMAIN"
run_tool "Chaos" "chaos -d $DOMAIN" 
run_tool "Haktrails" "haktrails subdomains $DOMAIN" 

# Solicitação à API do CRT.SH para obter os subdomínios
curl -s "https://crt.sh/?q=${DOMAIN}&output=json" | jq -r '.[].name_value' | sed 's/\*\.//g' \ 
    > "$RESULTS_DIR/crtsh_subdomains.txt"

echo "Resultados salvos em: $RESULTS_DIR"